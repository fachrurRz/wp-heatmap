'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  var queries = {};
  return function (next) {
    return function (_ref) {
      var soya = _ref.soya,
          action = (0, _objectWithoutProperties3.default)(_ref, ['soya']);

      if (typeof soya !== 'undefined') {
        var load = soya.load,
            _soya$id = soya.id,
            id = _soya$id === undefined ? action.type : _soya$id;

        if (typeof id !== 'string') {
          throw new Error('Expected soya action id to be a string.');
        }
        if (typeof load !== 'function') {
          throw new Error('Expected soya action load to be a function.');
        }

        var resolve = function resolve(soya) {
          next((0, _extends3.default)({}, action, {
            soya: soya
          }));
          delete queries[id];
          return soya;
        };
        var reject = resolve;
        if (!queries[id]) {
          queries[id] = load().then(resolve, reject);
        }
        return queries[id];
      }
      return next(action);
    };
  };
};